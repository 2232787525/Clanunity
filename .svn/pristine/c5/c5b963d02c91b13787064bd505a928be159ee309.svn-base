//
//  CULoginVC.swift
//  Clanunity
//
//  Created by 白bex on 2018/2/1.
//  Copyright © 2018年 DlmTechnology. All rights reserved.
//
import UIKit
import WebKit

//MARK: - ----------------wkwebview
class webVC: WKWebViewController,WKNavigationDelegate {

    var wkView : WKWebView!
    var urlStr = ""
    var titleStr = ""
    var bridge = WebViewJavascriptBridge()
    var getWebTitle = false

    override func kBackBtnAction() {
        if wkWebView.canGoBack{
            wkWebView.goBack()
        }else{
            super.kBackBtnAction()
        }
    }
    
    //MARK: - 加载页面 绘制UI
    override func viewDidLoad() {
        super.viewDidLoad()
        self.knavigationBar?.title = titleStr
        
        self.wkWebView.frame = CGRect.init(x: 0, y: KTopHeight, width: KScreenWidth, height: KScreenHeight - KTopHeight)
        self.makeJSBridge()
    }
    
    /// 创建web
    func makeJSBridge() -> Void {
        //开启日志
        WebViewJavascriptBridge.enableLogging()
        //给Objc与JS建立桥梁
        self.bridge = WebViewJavascriptBridge.init(forWebView: self.wkWebView)
//        self.bridge.setWebViewDelegate(self)
        
        //注册JS交互 ：关闭页面
        self.bridge.registerHandler("closeVC") { [weak self] (data, responseCallback) in
            self?.navigationController?.popViewController(animated: true)
        }
    }
    
    
    /// 加载webView
    func loadWebRequest() -> Void {
        
        var string = ""
        if urlStr.contains("http"){
            string = urlStr
        }else{
            string = ClanAPI.H5UserName + urlStr
        }
        string = "http://www.baidu.com"
//        let string = "http://192.168.1.153:8020" + urlStr
        let request = NSURLRequest.init(url: URL.init(string: string)!)
        self.wkView.load(request as URLRequest)
    }
    
    //MARK: - WKNavigationDelegate
    func webView(_ webView: WKWebView, didStartProvisionalNavigation navigation: WKNavigation!) {
        self.showGifView()
    }
    
    func webView(_ webView: WKWebView, didCommit navigation: WKNavigation!) {
        self.hiddenGifView()
    }
    func webView(_ webView: WKWebView, didFinish navigation: WKNavigation!) {
        self.hiddenGifView()
        self.knavigationBar?.title = self.wkView.title
    }

    func webView(_ webView: WKWebView, didFailProvisionalNavigation navigation: WKNavigation!, withError error: Error) {
        self.hiddenGifView()
    }
    
    override func didReceiveMemoryWarning() {
        super.didReceiveMemoryWarning()
    }
}
